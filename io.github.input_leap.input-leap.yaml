# Note: mDNS (foo.local) does NOT work, so server.name needs to be a FQDN or an ip address
# https://gitlab.com/freedesktop-sdk/freedesktop-sdk/-/issues/1013
app-id: io.github.input_leap.input-leap
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
command: input-leap
finish-args:
  - --device=dri
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --talk-name=org.kde.StatusNotifierWatcher
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/applications/mimeinfo.cache
  - /share/bash-completion
  - /share/icons/hicolor/icon-theme.cache
  - /share/man
  - /share/pkgconfig
  - '*.la'
modules:
  - name: avahi
    buildsystem: autotools
    config-opts:
      - --with-distro=none
      - --enable-compat-libdns_sd
      - --disable-compat-howl
      - --disable-introspection
      - --disable-qt3
      - --disable-qt4
      - --disable-qt5
      - --disable-gtk
      - --disable-gtk3
      - --disable-core-docs
      - --disable-manpages
      - --disable-libdaemon
      - --disable-python
      - --disable-pygobject
      - --disable-mono
      - --disable-monodoc
      - --disable-autoipd
      - --disable-doxygen-doc
      - --disable-doxygen-dot
      - --disable-doxygen-xml
      - --disable-doxygen-html
      - --disable-manpages
      - --disable-xmltoman
      - --disable-tests
    sources:
      - type: archive
        url: https://github.com/avahi/avahi/archive/refs/tags/v0.8.tar.gz
        sha256: c15e750ef7c6df595fb5f2ce10cac0fee2353649600e6919ad08ae8871e4945f
        x-checker-data:
          type: anitya
          project-id: 147
          url-template: https://github.com/avahi/avahi/archive/refs/tags/v$version.tar.gz
    modules:
      - name: libevent
        buildsystem: cmake-ninja
        config-opts:
          - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
        sources:
          - type: archive
            url: https://github.com/libevent/libevent/archive/refs/tags/release-2.1.12-stable.tar.gz
            sha256: 7180a979aaa7000e1264da484f712d403fcf7679b1e9212c4e3d09f5c93efc24
            x-checker-data:
              type: anitya
              project-id: 1606
              url-template: https://github.com/libevent/libevent/archive/refs/tags/release-$version-stable.tar.gz
      - name: libdaemon
        buildsystem: autotools
        config-opts:
          - --disable-lynx
        sources:
          - type: archive
            url: https://0pointer.de/lennart/projects/libdaemon/libdaemon-0.14.tar.gz
            sha256: fd23eb5f6f986dcc7e708307355ba3289abe03cc381fc47a80bca4a50aa6b834
            x-checker-data:
              type: anitya
              project-id: 13299
              url-template: https://0pointer.de/lennart/projects/libdaemon/libdaemon-$version.tar.gz
          - type: shell
            commands:
              - cp -p /usr/share/automake-*/config.{sub,guess} .
  - name: input-leap
    buildsystem: cmake-ninja
    config-opts:
      - -DQT_DEFAULT_MAJOR_VERSION=6
      - -DINPUTLEAP_BUILD_GUI=ON
      - -DINPUTLEAP_BUILD_TESTS=OFF
      - -DINPUTLEAP_BUILD_X11=ON
      - -DINPUTLEAP_BUILD_LIBEI=ON
    sources:
      - type: archive
        url: https://github.com/input-leap/input-leap/archive/refs/tags/v3.0.3.tar.gz
        sha256: fbbf6e3f99abccfc3592939a039daf13f0e003dd33764c7c591d354b1a6c07eb
        x-checker-data:
          type: anitya
          project-id: 374956
          url-template: https://github.com/input-leap/input-leap/archive/refs/tags/v$version.tar.gz
      - type: patch
        path: xdg-location-for-config.patch
    modules:
      - name: libei
        buildsystem: meson
        config-opts:
          - -Dtests=disabled
          - -Dliboeffis=disabled
        sources:
          - type: archive
            url: https://gitlab.freedesktop.org/libinput/libei/-/archive/1.5.0/libei-1.5.0.tar.gz
            sha256: 7687c3bbcff89ff331c5db72e0a5cce6bcae382e3c238d6f7019a6bc71d88e43
            x-checker-data:
              type: anitya
              project-id: 350087
              url-template: https://gitlab.freedesktop.org/libinput/libei/-/archive/$version/libei-$version.tar.gz
        modules:
          - name: python3-attrs
            buildsystem: simple
            build-commands:
              - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
                --prefix=${FLATPAK_DEST} --no-build-isolation attrs
            sources:
              - type: file
                url: https://files.pythonhosted.org/packages/6b/5c/685e6633917e101e5dcb62b9dd76946cbb57c26e133bae9e0cd36033c0a9/attrs-25.4.0.tar.gz
                sha256: 16d5969b87f0859ef33a48b35d55ac1be6e42ae49d5e853b597db70c35c57e11
                x-checker-data:
                  type: pypi
                  name: attrs
            modules:
              - hachling.yaml
          - name: python3-Jinja2
            buildsystem: simple
            build-commands:
              - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
                --prefix=${FLATPAK_DEST} --no-build-isolation Jinja2
            modules:
              - name: python3-flit-core
                buildsystem: simple
                build-commands:
                  - pip3 install --no-index --no-build-isolation --prefix="${FLATPAK_DEST}"
                    .
                cleanup: ['*']
                sources:
                  - type: archive
                    url: https://files.pythonhosted.org/packages/69/59/b6fc2188dfc7ea4f936cd12b49d707f66a1cb7a1d2c16172963534db741b/flit_core-3.12.0.tar.gz
                    sha256: 18f63100d6f94385c6ed57a72073443e1a71a4acb4339491615d0f16d6ff01b2
                    x-checker-data:
                      type: pypi
                      name: flit-core
            sources:
              - type: file
                url: https://files.pythonhosted.org/packages/df/bf/f7da0350254c0ed7c72f3e33cef02e048281fec7ecec5f032d4aac52226b/jinja2-3.1.6.tar.gz
                sha256: 0137fb05990d35f1275a587e9aee6d56da821fc83491a0fb838183be43f66d6d
                x-checker-data:
                  type: pypi
                  name: Jinja2
              - type: file
                url: https://files.pythonhosted.org/packages/7e/99/7690b6d4034fffd95959cbe0c02de8deb3098cc577c67bb6a24fe5d7caa7/markupsafe-3.0.3.tar.gz
                sha256: 722695808f4b6457b320fdc131280796bdceb04ab50fe1795cd540799ebe1698
                x-checker-data:
                  type: pypi
                  name: MarkupSafe
            cleanup:
              - /lib/python*
        cleanup:
          - /include
          - /bin
          - /lib/pkgconfig

      - name: libportal
        buildsystem: meson
        config-opts:
          - -Ddocs=false
          - -Dtests=false
          - -Dportal-tests=false
          - -Dvapi=false
          - -Dbackend-qt5=disabled
          - -Dbackend-qt6=auto
          - -Dbackend-gtk4=disabled
        sources:
          - type: archive
            url: https://github.com/flatpak/libportal/releases/download/0.9.1/libportal-0.9.1.tar.xz
            sha256: de801ee349ed3c255a9af3c01b1a401fab5b3fc1c35eb2fd7dfb35d4b8194d7f
            x-checker-data:
              type: anitya
              project-id: 230124
              url-template: https://github.com/flatpak/libportal/releases/download/$version/libportal-$version.tar.xz
          - type: patch
            path: ./libportal-qt6.patch
